<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>电子书思维导图转换工具</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-book-open"></i> 电子书思维导图转换工具</h1>
            <p>使用本地Ollama模型将电子书转换为结构化思维导图</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="upload"><i class="fas fa-upload"></i> 文件上传</button>
            <button class="nav-tab" data-tab="conversion"><i class="fas fa-cog"></i> 转换管理</button>
            <button class="nav-tab" data-tab="mindmap"><i class="fas fa-project-diagram"></i> 思维导图库</button>
            <button class="nav-tab" data-tab="settings"><i class="fas fa-wrench"></i> 设置</button>
        </div>

        <div class="main-content">
            <div id="upload" class="tab-content active">
                <div class="upload-section">
                    <div id="uploadArea" class="upload-area">
                        <div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
                        <h3>拖拽文件到此处或点击选择文件</h3>
                        <p>支持格式: EPUB, PDF, TXT, RTF, DOCX, MOBI, AZW, AZW3, CBR, CBZ</p>
                        <input type="file" id="fileInput" multiple accept=".epub,.pdf,.txt,.rtf,.docx,.mobi,.azw,.azw3,.cbr,.cbz">
                        <button id="selectFiles" class="upload-btn"><i class="fas fa-file-upload"></i> 选择文件</button>
                    </div>

                    <div class="model-selection">
                        <label for="modelSelect">选择Ollama模型:</label>
                        <select id="modelSelect">
                            <option value="">加载中...</option>
                        </select>
                        <button id="refreshModels" class="btn-primary"><i class="fas fa-sync"></i> 刷新模型</button>
                    </div>

                    <div class="upload-actions">
                        <button id="startUpload" class="btn-primary" disabled><i class="fas fa-play"></i> 开始上传</button>
                        <button id="clearFiles" class="btn-secondary"><i class="fas fa-trash-alt"></i> 清空列表</button>
                    </div>

                    <div id="fileList" class="file-list"></div>
                </div>
            </div>

            <div id="conversion" class="tab-content">
                <div class="conversion-controls">
                    <div class="controls-row">
                        <button id="startAllConversions" class="btn-primary"><i class="fas fa-play-circle"></i> 开始全部转换</button>
                        <button id="cancelAllConversions" class="btn-danger"><i class="fas fa-stop-circle"></i> 取消全部转换</button>
                        <button id="exportExcel" class="btn-success"><i class="fas fa-file-excel"></i> 导出Excel报告</button>
                        <div class="per-page-group">
                            <select id="conversionsPerPageSelect">
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="30">30</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                                <option value="0">ALL</option>
                            </select>
                        </div>
                    </div>
                    <div class="progress-stats">
                        <div class="stat-card">
                            <h4>总文件数</h4>
                            <div class="stat-number" id="totalFiles">0</div>
                        </div>
                        <div class="stat-card">
                            <h4>已完成</h4>
                            <div class="stat-number" id="completedFiles">0</div>
                        </div>
                        <div class="stat-card">
                            <h4>处理中</h4>
                            <div class="stat-number" id="processingFiles">0</div>
                        </div>
                        <div class="stat-card">
                            <h4>总耗时</h4>
                            <div class="stat-number" id="totalTime">0秒</div>
                        </div>
                    </div>
                </div>
                <div id="conversionList" class="file-list"></div>
                <div id="conversionPagination" class="pagination"></div>
            </div>

            <div id="mindmap" class="tab-content">
                <div class="search-section">
                    <div class="controls-row">
                        <div class="search-group">
                            <input type="text" id="searchKeyword" placeholder="输入关键字搜索...">
                            <button id="searchBtn" class="btn-primary"><i class="fas fa-search"></i> 搜索</button>
                        </div>
                        <div class="filter-group">
                            <select id="dateFilter">
                                <option value="">全部时间</option>
                                <option value="today">今天</option>
                                <option value="week">本周</option>
                                <option value="month">本月</option>
                            </select>
                            <select id="modelFilter">
                                <option value="">全部模型</option>
                            </select>
                            <button id="clearFilters" class="btn-secondary"><i class="fas fa-eraser"></i> 清除筛选</button>
                        </div>
                        <div class="per-page-group">
                            <select id="perPageSelect">
                                <option value="9">9</option>
                                <option value="18">18</option>
                                <option value="27">27</option>
                                <option value="36">36</option>
                                <option value="48">48</option>
                                <option value="60">60</option>
                                <option value="72">72</option>
                                <option value="99">99</option>
                                <option value="0">ALL</option>
                            </select>
                        </div>
                    </div>
                    <div id="mindmapGrid" class="mindmap-grid"></div>
                    <div id="pagination" class="pagination"></div>
                </div>
            </div>

            <div id="settings" class="tab-content">
                <div class="settings-section">
                    <h3><i class="fas fa-server"></i> Ollama设置</h3>
                    <div class="setting-item">
                        <label for="ollamaUrl">Ollama服务地址:</label>
                        <input type="text" id="ollamaUrl" value="http://localhost:11434">
                        <button id="testOllama" class="btn-primary"><i class="fas fa-plug"></i> 测试连接</button>
                    </div>
                    <div class="setting-item">
                        <label for="defaultModel">默认模型:</label>
                        <select id="defaultModel">
                            <option value="">加载中...</option>
                        </select>
                    </div>
                </div>
                <div class="settings-section">
                    <h3><i class="fas fa-database"></i> 数据库设置</h3>
                    <div class="setting-item">
                        <label>数据库状态:</label>
                        <span id="dbStatus" class="status-indicator">检查中...</span>
                        <button id="testDb" class="btn-primary"><i class="fas fa-plug"></i> 测试连接</button>
                    </div>
                </div>
                <div class="settings-section">
                    <h3><i class="fas fa-chart-bar"></i> 系统统计</h3>
                    <div id="systemStats" class="stats-grid"></div>
                </div>
            </div>
        </div>

        <div id="progressModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>转换进度</h3>
                    <button class="modal-close" onclick="closeProgressModal()">×</button>
                </div>
                <div class="modal-body">
                    <div id="progressList">
                        <div class="progress-item">
                            <div class="progress-info">
                                <span class="filename">文件名</span>
                                <span class="progress-text">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 0%"></div>
                            </div>
                            <div class="progress-message">准备中...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="notifications" class="notifications"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.0/socket.io.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
